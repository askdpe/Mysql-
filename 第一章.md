# 第一章

 **QPS**:是Queries Per Second的缩写，意思是每秒查询率，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。

**TPS**:是Transactions Per Second的缩写，也就是事务数/秒。它是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。


**影响数据库的因素**

1. sql查询速度
2. 服务器硬件
3. 网卡流量
4. 磁盘IO


**大量的并发和超高的CPU使用率造成的风险**

- 大量的并发：数据库连接数被占满（max_connections默认100）
- 超高的CPU使用率：因CPU资源耗尽而出现宕机


**磁盘IO**

- 磁盘IO性能突然下降（使用更快的磁盘数据）
- 其它大量消耗磁盘性能的计划任务（调整计划任务，做好磁盘维护 eg：不在主库上备份）


**网卡流量**

- 网卡IO被沾满（1000Mb/8≈100MB）

  如何避免无法连接数据库的情况：

  - 减少从服务器的数量
  - 进行分级缓存
  - 避免使用“sleect *”进行查询
  - 分离业务网络和服务网络


**大表**：单表超过千万行，数据文件超过10G

大表对查询的影响

- 慢查询：很难在一定的时间内过滤出所需要的数据

大表对DDL操作的影响

- 建立索引需要很长的时间：5.5以前建立索引会锁表。5.5以后不会锁表但会产生主从延迟
- 修改表结构需要长时间锁表：会造成长时间的主从延迟，影响正常的数据操作

如何处理数据库中的大表

1. 分库分表把一张大表分成多个小表
   - 分表主键的选择
   - 分表后跨分区数据的查询和统计

2. 大表的历史数据归档减少对后端业务的影响
   - 归档时间点的选择
   - 如何进行归档操作

**事务**：事务是数据库系统区别于其它一切文件系统的重要特性之一，是一组具有原子性的SQL		      语句，或是一个独立的工作单元（原子性，一致性，隔离性，持久性）
1. 原子性：一个事务必须被视为一个不可分割的最小单元，整个事务中的所有操作要么全部提交成功，要么全部执行失败，对于一个事务来说，不可能只执行其中的一部分操作
2. 一致性：一致性是指事务将数据库从一种一致性状态转换到另一种一致性状态，在事务开始之前和事务结束后数据库中数据的完整性没有被破坏
3. 隔离性：要求一个事务对数据库中数据的修改，在未提交完成前对于其它事务时不可见的
	- 未提交读（READ UNCOMMITED）造成脏读
	- 已提交读（READ COMMITED）Oracle默认
	- 可重复读（REPEATABLE READ）mysql默认
	- 可串行化（SERIALIZABLE）很少使用，会加锁，性能低
4. 持久性：一旦事务提交，则其所做的修改就会永久保存到数据库中。此时即使系统崩溃，已经提交的数据也不会丢失
**大事务**：运行时间比较长，操作的数据比较多的事务
1. 锁定太多的数据，造成大量的阻塞和锁超时
2. 回滚时所需要的时间比较长
3. 执行时间长，容易造成主从延迟
**如何处理大事务**：
	- 避免一次处理太多数据
	- 移除不必要在事务中的SELECT操作